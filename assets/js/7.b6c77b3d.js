(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{168:function(t,e,n){"use strict";n.r(e);var s=n(0),a=Object(s.a)({},function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"content"},[t._m(0),t._v(" "),n("p"),t._m(1),n("p"),t._v(" "),n("div",{staticClass:"warning custom-block"},[n("p",{staticClass:"custom-block-title"},[t._v("WARNING")]),t._v(" "),n("p",[t._v("This tutorial uses examples from our "),n("a",{attrs:{href:"https://github.com/pterodactyl/images/tree/java",target:"_blank",rel:"noopener noreferrer"}},[n("code",[t._v("core:java")]),n("OutboundLink")],1),t._v(" docker image,\nwhich can be found on Github. This tutorial also assumes some knowledge of "),n("a",{attrs:{href:"https://docker.io/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Docker"),n("OutboundLink")],1),t._v(", we suggest\nreading up if this all looks foreign to you.")])]),t._v(" "),t._m(2),t._v(" "),n("p",[t._v("The most important part of this process is to create the "),n("a",{attrs:{href:"https://docs.docker.com/engine/reference/builder/",target:"_blank",rel:"noopener noreferrer"}},[n("code",[t._v("Dockerfile")]),n("OutboundLink")],1),t._v("\nthat will be used by the Daemon. Due to heavy restrictions on server containers, you must setup this file in a specific manner.")]),t._v(" "),n("p",[t._v("We try to make use of "),n("a",{attrs:{href:"https://alpinelinux.org",target:"_blank",rel:"noopener noreferrer"}},[t._v("Alpine Linux"),n("OutboundLink")],1),t._v(" as much as possible for our images in order to keep their size down.")]),t._v(" "),t._m(3),n("p",[t._v("Lets walk through the "),n("code",[t._v("Dockerfile")]),t._v(" above. The first thing you'll notice is the "),n("a",{attrs:{href:"https://docs.docker.com/engine/reference/builder/#from",target:"_blank",rel:"noopener noreferrer"}},[n("code",[t._v("FROM")]),n("OutboundLink")],1),t._v(" declaration.")]),t._v(" "),t._m(4),n("p",[t._v("In this case, we are using "),n("a",{attrs:{href:"https://github.com/docker-library/openjdk",target:"_blank",rel:"noopener noreferrer"}},[n("code",[t._v("fopenjdk:8-jdk-alpine")]),n("OutboundLink")],1),t._v(" which provides us with Java 8.")]),t._v(" "),t._m(5),t._v(" "),n("p",[t._v("The next thing we do is install the dependencies we will need using Alpine's package manager: "),n("code",[t._v("apk")]),t._v(". You'll notice some\nspecific flags that keep the container small, including "),n("code",[t._v("--no-cache")]),t._v(", as well as everything being contained in a\nsingle "),n("a",{attrs:{href:"https://docs.docker.com/engine/reference/builder/#run",target:"_blank",rel:"noopener noreferrer"}},[n("code",[t._v("RUN")]),n("OutboundLink")],1),t._v(" block.")]),t._v(" "),t._m(6),t._v(" "),t._m(7),t._v(" "),t._m(8),n("p",{staticClass:"callout warning"},[t._v("All Pterodactyl containers must have a user named `container`, and the user home **must** be `/home/container`.")]),t._v(" "),n("p",[t._v("After we create that user, we then define the default container "),n("a",{attrs:{href:"https://docs.docker.com/engine/reference/builder/#user",target:"_blank",rel:"noopener noreferrer"}},[n("code",[t._v("USER")]),n("OutboundLink")],1),t._v("\nas well as a few "),n("a",{attrs:{href:"https://docs.docker.com/engine/reference/builder/#env",target:"_blank",rel:"noopener noreferrer"}},[n("code",[t._v("ENV")]),n("OutboundLink")],1),t._v(" settings to be applied to things running\nwithin the container.")]),t._v(" "),t._m(9),t._v(" "),n("p",[t._v("One of the last things we do is define a "),n("a",{attrs:{href:"https://docs.docker.com/engine/reference/builder/#workdir",target:"_blank",rel:"noopener noreferrer"}},[n("code",[t._v("WORKDIR")]),n("OutboundLink")],1),t._v(" which\nis where everything else will be executed. The "),n("code",[t._v("WORKDIR")]),t._v(" must be set the "),n("code",[t._v("/home/container")]),t._v(".")]),t._v(" "),n("p",[t._v("Finally, we need to copy our "),n("a",{attrs:{href:"https://docs.docker.com/engine/reference/builder/#entrypoint",target:"_blank",rel:"noopener noreferrer"}},[n("code",[t._v("ENTRYPOINT")]),n("OutboundLink")],1),t._v(" script into\nthe docker image root. This is done using "),n("a",{attrs:{href:"https://docs.docker.com/engine/reference/builder/#copy",target:"_blank",rel:"noopener noreferrer"}},[n("code",[t._v("COPY")]),n("OutboundLink")],1),t._v(", after which\nwe define the command to be used when the container is started using "),n("a",{attrs:{href:"https://docs.docker.com/engine/reference/builder/#cmd",target:"_blank",rel:"noopener noreferrer"}},[n("code",[t._v("CMD")]),n("OutboundLink")],1),t._v(".\nThe "),n("code",[t._v("CMD")]),t._v(" line should always point to the "),n("code",[t._v("entrypoint.sh")]),t._v(" file.")]),t._v(" "),t._m(10),t._m(11),t._v(" "),t._m(12),t._v(" "),n("p",[t._v("These entrypoint files are actually fairly abstracted, and the Daemon will pass in the start command as an environment\nvariable before processing it and then executing the command.")]),t._v(" "),t._m(13),t._m(14),t._v(" "),t._m(15),t._v(" "),t._m(16),t._v(" "),t._m(17),t._m(18),t._v(" "),t._m(19),n("p",[t._v("There are a host of different environment variables, and they change depending on the specific service option\nconfiguration. However, that is not necessarily anything to worry about here.")]),t._v(" "),t._m(20),t._m(21),t._v(" "),t._m(22),n("p",[t._v("Becomes:")]),t._v(" "),t._m(23),t._m(24),t._v(" "),t._m(25)])},[function(){var t=this.$createElement,e=this._self._c||t;return e("h1",{attrs:{id:"creating-a-custom-docker-image"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#creating-a-custom-docker-image","aria-hidden":"true"}},[this._v("#")]),this._v(" Creating a Custom Docker Image")])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"table-of-contents"},[e("ul",[e("li",[e("a",{attrs:{href:"#creating-the-dockerfile"}},[this._v("Creating the Dockerfile")])]),e("li",[e("a",{attrs:{href:"#installing-dependencies"}},[this._v("Installing Dependencies")])]),e("li",[e("a",{attrs:{href:"#creating-a-container-user"}},[this._v("Creating a Container User")])]),e("li",[e("a",{attrs:{href:"#work-directory-entrypoint"}},[this._v("Work Directory & Entrypoint")])]),e("li",[e("a",{attrs:{href:"#entrypoint-script"}},[this._v("Entrypoint Script")])]),e("li",[e("a",{attrs:{href:"#modifying-the-startup-command"}},[this._v("Modifying the Startup Command")])]),e("li",[e("a",{attrs:{href:"#run-the-command"}},[this._v("Run the Command")])])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"creating-the-dockerfile"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#creating-the-dockerfile","aria-hidden":"true"}},[this._v("#")]),this._v(" Creating the Dockerfile")])},function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"language-bash extra-class"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{attrs:{class:"token comment"}},[t._v("# ----------------------------------")]),t._v("\n"),n("span",{attrs:{class:"token comment"}},[t._v("# Pterodactyl Core Dockerfile")]),t._v("\n"),n("span",{attrs:{class:"token comment"}},[t._v("# Environment: Java")]),t._v("\n"),n("span",{attrs:{class:"token comment"}},[t._v("# Minimum Panel Version: 0.6.0")]),t._v("\n"),n("span",{attrs:{class:"token comment"}},[t._v("# ----------------------------------")]),t._v("\nFROM openjdk:8-jdk-alpine\n\nMAINTAINER Pterodactyl Software, "),n("span",{attrs:{class:"token operator"}},[t._v("<")]),t._v("support@pterodactyl.io"),n("span",{attrs:{class:"token operator"}},[t._v(">")]),t._v("\n\nRUN apk add --no-cache --update "),n("span",{attrs:{class:"token function"}},[t._v("curl")]),t._v(" ca-certificates openssl "),n("span",{attrs:{class:"token function"}},[t._v("git")]),t._v(" "),n("span",{attrs:{class:"token function"}},[t._v("tar")]),t._v(" "),n("span",{attrs:{class:"token function"}},[t._v("bash")]),t._v(" sqlite fontconfig \\\n    "),n("span",{attrs:{class:"token operator"}},[t._v("&&")]),t._v(" adduser -D -h /home/container container\n\nUSER container\nENV  USER"),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v("container HOME"),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v("/home/container\n\nWORKDIR /home/container\n\nCOPY ./entrypoint.sh /entrypoint.sh\n\nCMD "),n("span",{attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{attrs:{class:"token string"}},[t._v('"/bin/bash"')]),t._v(", "),n("span",{attrs:{class:"token string"}},[t._v('"/entrypoint.sh"')]),n("span",{attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[this._v("FROM openjdk:8-jdk-alpine\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"installing-dependencies"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#installing-dependencies","aria-hidden":"true"}},[this._v("#")]),this._v(" Installing Dependencies")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"creating-a-container-user"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#creating-a-container-user","aria-hidden":"true"}},[this._v("#")]),this._v(" Creating a Container User")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("Within this "),e("code",[this._v("RUN")]),this._v(" block, you'll notice the "),e("code",[this._v("useradd")]),this._v(" command.")])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[this._v("adduser -D -h /home/container container\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"work-directory-entrypoint"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#work-directory-entrypoint","aria-hidden":"true"}},[this._v("#")]),this._v(" Work Directory & Entrypoint")])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[this._v("COPY ./entrypoint.sh /entrypoint.sh\nCMD "),e("span",{attrs:{class:"token punctuation"}},[this._v("[")]),e("span",{attrs:{class:"token string"}},[this._v('"/bin/bash"')]),this._v(", "),e("span",{attrs:{class:"token string"}},[this._v('"/entrypoint.sh"')]),e("span",{attrs:{class:"token punctuation"}},[this._v("]")]),this._v("\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"entrypoint-script"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#entrypoint-script","aria-hidden":"true"}},[this._v("#")]),this._v(" Entrypoint Script")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("In order to complete this "),e("code",[this._v("Dockerfile")]),this._v(", we will need an "),e("code",[this._v("entrypoint.sh")]),this._v(" file which tells Docker how to run this\nspecific server type.")])},function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"language-bash extra-class"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{attrs:{class:"token shebang important"}},[t._v("#!/bin/bash")]),t._v("\n"),n("span",{attrs:{class:"token function"}},[t._v("cd")]),t._v(" /home/container\n\n"),n("span",{attrs:{class:"token comment"}},[t._v("# Output Current Java Version")]),t._v("\njava -version "),n("span",{attrs:{class:"token comment"}},[t._v("## only really needed to show what version is being used. Should be changed for different applications")]),t._v("\n\n"),n("span",{attrs:{class:"token comment"}},[t._v("# Replace Startup Variables")]),t._v("\nMODIFIED_STARTUP"),n("span",{attrs:{class:"token operator"}},[t._v("=")]),n("span",{attrs:{class:"token variable"}},[n("span",{attrs:{class:"token variable"}},[t._v("`")]),n("span",{attrs:{class:"token function"}},[t._v("eval")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("echo")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("$(")]),t._v("echo $"),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("STARTUP"),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),n("span",{attrs:{class:"token function"}},[t._v("sed")]),t._v(" -e "),n("span",{attrs:{class:"token string"}},[t._v("'s/{{/${/g'")]),t._v(" -e "),n("span",{attrs:{class:"token string"}},[t._v("'s/}}/}/g'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token variable"}},[t._v("`")])]),t._v("\n"),n("span",{attrs:{class:"token keyword"}},[t._v("echo")]),t._v(" "),n("span",{attrs:{class:"token string"}},[t._v('":/home/container$ '),n("span",{attrs:{class:"token variable"}},[t._v("${MODIFIED_STARTUP}")]),t._v('"')]),t._v("\n\n"),n("span",{attrs:{class:"token comment"}},[t._v("# Run the Server")]),t._v("\n"),n("span",{attrs:{class:"token variable"}},[t._v("${MODIFIED_STARTUP}")]),t._v("\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("The second command, "),e("code",[this._v("cd /home/container")]),this._v(", simply ensures we are in the correct directory when running the rest of the\ncommands. We then follow that up with "),e("code",[this._v("java -version")]),this._v(" to output this information to end-users, but that is not necessary.")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"modifying-the-startup-command"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#modifying-the-startup-command","aria-hidden":"true"}},[this._v("#")]),this._v(" Modifying the Startup Command")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("The most significant part of this file is the "),e("code",[this._v("MODIFIED_STARTUP")]),this._v(" environment variable. What we are doing in this case\nis parsing the environment "),e("code",[this._v("STARTUP")]),this._v(" that is passed into the container by the Daemon. In most cases, this variable\nlooks something like the example below:")])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[this._v("STARTUP"),e("span",{attrs:{class:"token operator"}},[this._v("=")]),e("span",{attrs:{class:"token string"}},[this._v('"java -Xms128M -Xmx{{SERVER_MEMORY}}M -jar {{SERVER_JARFILE}}"')]),this._v("\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{pre:!0},[e("p",[this._v("You'll notice some placeholders there, specifically "),e("code",[this._v("{{SERVER_MEMORY}}")]),this._v(" and "),e("code",[this._v("{{SERVER_JARFILE}}")]),this._v(". These both refer to\nother environment variables being passed in, and they look something like the example below.")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[this._v("SERVER_MEMORY"),e("span",{attrs:{class:"token operator"}},[this._v("=")]),this._v("1024\nSERVER_JARFILE"),e("span",{attrs:{class:"token operator"}},[this._v("=")]),this._v("server.jar\n")])])])},function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"language-bash extra-class"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[t._v("MODIFIED_STARTUP"),n("span",{attrs:{class:"token operator"}},[t._v("=")]),n("span",{attrs:{class:"token variable"}},[n("span",{attrs:{class:"token variable"}},[t._v("`")]),n("span",{attrs:{class:"token function"}},[t._v("eval")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("echo")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("$(")]),t._v("echo $"),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("STARTUP"),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),n("span",{attrs:{class:"token function"}},[t._v("sed")]),t._v(" -e "),n("span",{attrs:{class:"token string"}},[t._v("'s/{{/${/g'")]),t._v(" -e "),n("span",{attrs:{class:"token string"}},[t._v("'s/}}/}/g'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token variable"}},[t._v("`")])]),t._v("\n")])])])},function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{pre:!0},[n("p",[t._v("The command above simply evaluates the "),n("code",[t._v("STARTUP")]),t._v(" environment variable, and then replaces anything surrounded in\ncurly braces "),n("code",[t._v("{{EXAMPLE}}")]),t._v(" with a matching environment variable (such as "),n("code",[t._v("EXAMPLE")]),t._v("). Thus, our "),n("code",[t._v("STARTUP")]),t._v(" command:")])])},function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"language-bash extra-class"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[t._v("java -Xms128M -Xmx"),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("SERVER_MEMORY"),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("M -jar "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("SERVER_JARFILE"),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[this._v("java -Xms128M -Xmx1024M -jar server.jar\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"run-the-command"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#run-the-command","aria-hidden":"true"}},[this._v("#")]),this._v(" Run the Command")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("The last step is to run this modified startup command, which is done with the line "),e("code",[this._v("${MODIFIED_STARTUP}")]),this._v(".")])}],!1,null,null,null);e.default=a.exports}}]);